#!/usr/bin/env node
'use strict';
const program = require('commander');
const runScript = require('runscript');
const path = require('path');
const chalk = require('chalk');

const { getProcessList, start, stop } = new require('../lib/utils/action');

program
  .option('--start', 'start server')
  .option('--stop', 'stop server')
  .option('--restart', 'restart server')
  .option('--list', 'list active process')
  .option('--log', 'show logs');

program.parse(process.argv);

if (program.start) {
  start();
} else if (program.stop) {
  stop();
} else if (program.restart) {
  stop().then(() => {
    start();
  });
} else if (program.list) {
  getProcessList();
} else if (program.log) {
  runScript(`cat ${path.join(__dirname, '../out1.log')}`, {
    stdio: 'pipe'
  })
    .then(stdio => {
      console.log(stdio.stdout.toString());
    })
    .catch(err => {
      console.error(err);
    });
} else {
  console.log(chalk.red('no command matched.'));
}
